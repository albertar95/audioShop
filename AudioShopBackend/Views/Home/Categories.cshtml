@model List<AudioShopBackend.Models.Category>
@{
    ViewBag.Title = "Categories";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="form-example-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align:right;direction:rtl;">
                <div class="form-element-list" id="divCategoryForm">
                    <div class="alert alert-success" role="alert" hidden="hidden" id="successfullMessageDiv"></div>
                    <div class="alert alert-warning" role="alert" hidden="hidden" id="warningMessageDiv"></div>
                    <div class="alert alert-danger" role="alert" hidden="hidden" id="errorMessageDiv"></div>
                    <div class="basic-tb-hd">
                        <h2>Categories</h2>
                        <p>desc about categories</p>
                    </div>
                    <div class="row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <div class="nk-int-st">
                                    <input type="text" class="form-control" placeholder="type name" id="txtTypeName">
                                </div>
                                <div class="form-ic-cmp button-icon-btn button-icon-btn-cl sm-res-mg-t-30">
                                    <button class="btn btn-lightgreen lightgreen-icon-notika btn-reco-mg btn-button-mg waves-effect" id="btnAddType"><i class="notika-icon notika-checked" style="top:0 !important;"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <div class="nk-int-st">
                                    <input type="text" class="form-control" placeholder="brand name" id="txtBrandName">
                                </div>
                                <div class="form-ic-cmp button-icon-btn button-icon-btn-cl sm-res-mg-t-30">
                                    <button class="btn btn-lightgreen lightgreen-icon-notika btn-reco-mg btn-button-mg waves-effect" id="btnAddBrand"><i class="notika-icon notika-checked" style="top:0 !important;"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <div class="form-ic-cmp">
                                    <i class="notika-icon notika-edit"></i>
                                </div>
                                <div class="nk-int-st">
                                    <input type="text" class="form-control" placeholder="categoryname" id="txtCategoryName">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int" id="TypeWrap">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int" id="BrandWrap">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <div class="form-ic-cmp">
                                    <i class="notika-icon notika-star"></i>
                                </div>
                                <div class="nk-int-st">
                                    <textarea class="form-control" placeholder="desc" id="txtDescription"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <div class="form-ic-cmp">
                                    <i class="notika-icon notika-star"></i>
                                </div>
                                <div class="nk-int-st">
                                    <input type="text" class="form-control" placeholder="keywords" id="txtKeywords">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <a href="@Url.Action("ManageTypeAndBrand","Home",new { IsBrand = false})" style="text-decoration:underline;">manage category types</a>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <a href="@Url.Action("ManageTypeAndBrand","Home",new { IsBrand = true })" style="text-decoration:underline;">manage category brands</a>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <div class="nk-int-st">
                                    <button class="btn notika-btn-green btn-reco-mg btn-button-mg waves-effect" id="btnAddCategory">add this!</button>
                                    <button class="btn notika btn-reco-mg btn-button-mg waves-effect" id="btnClearForm">clear form</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="data-table-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="data-table-list">
                    <div class="basic-tb-hd">
                        <h2>Basic Example</h2>
                        <p>It's just that simple. Turn your simple table into a sophisticated data table and offer your users a nice experience and great features without any effort.</p>
                    </div>
                    <div class="table-responsive">
                        <table id="data-table-basic" class="table table-striped">
                            <thead>
                                <tr>
                                    <th>NidCategory</th>
                                    <th>CategoryName</th>
                                    <th>Types</th>
                                    <th>Brands</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="tblCategory">
                                @foreach (var cat in Model)
                                {
                                    <tr>
                                        <td>@cat.NidCategory</td>
                                        <td>@cat.CategoryName</td>
                                        <td>
                                            <div class="col-sm-12">
                                                @foreach (var typ in cat.Category_Types.Take(4))
                                                {
                                                    <div class="col-sm-6">
                                                        <button class="btn btn-default btn-icon-notika waves-effect">
                                                             @typ.TypeName
                                                        </button>
                                                    </div>
                                                }
                                            </div>
                                        </td>
                                        <td>
                                            <div class="col-sm-12">
                                                @foreach (var brd in cat.Category_Brands.Take(4))
                                                {
                                                    <div class="col-sm-6">
                                                    <button class="btn btn-default btn-icon-notika waves-effect">
                                                         @brd.BrandName
                                                    </button>
                                                        </div>
                                                }
                                            </div>
                                        </td>
                                        <td>
                                            <button onclick="EditThis(@cat.NidCategory)" class="btn btn-warning notika-btn-warning waves-effect">Edit</button>
                                            <button onclick="DeleteThis(@cat.NidCategory)" class="btn btn-danger notika-btn-danger waves-effect">Delete</button>
                                            <button onclick="DetailThis(@cat.NidCategory)" class="btn btn-info notika-btn-info waves-effect"  data-toggle="modal">Detail</button>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal animated bounce" id="DetailModal" role="dialog" style="display: none;"></div>


@section styles
    {
    <link rel="stylesheet" href="@Url.Content("~/Content/css/jquery.dataTables.min.css")">
     }

@section scripts
    {
<script src="@Url.Content("~/Content/js/data-table/jquery.dataTables.min.js")"></script>
<script src="@Url.Content("~/Content/js/data-table/data-table-act.js")"></script>
    <script type="text/javascript">
        var IsCategoryAdded = false;
        var NidCurrentCategory = 0;
        $(function () {
            $("#btnAddCategory").click(function (e) {
                e.preventDefault();
                if ($("#txtCategoryName").val() == '') {
                    $("#warningMessageDiv").html('category name is null');
                    $("#warningMessageDiv").removeAttr('hidden');
                    setTimeout(function () {
                        $("#warningMessageDiv").prop('hidden', 'hidden');
                    }, 3000);
                } else {
                    if (IsCategoryAdded) {
                        $.ajax(
                            {
                                url: '@Url.Action("AddCategory","Home")',
                                type: 'post',
                                datatype: 'json',
                                data: { IsNewCategory: false, Name: $("#txtCategoryName").val(), NidCategory: NidCurrentCategory, CategoryDescription: $("#txtDescription").val(), categoryKeywords: $("#txtKeywords").val() },
                                success: function (result) {
                                    if (result.HasValue) {
                                        UpdateTableContent();
                                        $("#txtCategoryName").val("");
                                        $("#txtDescription").val("");
                                        $("#txtKeywords").val("");
                                        NidCurrentCategory = 0;
                                        IsCategoryAdded = false;
                                        $("#BrandWrap").html("");
                                        $("#TypeWrap").html("");
                                        $("#successfullMessageDiv").html('category added successfully!');
                                        $("#successfullMessageDiv").removeAttr('hidden');
                                        setTimeout(function () {
                                            $("#successfullMessageDiv").prop('hidden', 'hidden');
                                        }, 5000);
                                    } else {
                                        $("#errorMessageDiv").html(result.Message);
                                        $("#errorMessageDiv").removeAttr('hidden');
                                        setTimeout(function () {
                                            $("#errorMessageDiv").prop('hidden', 'hidden');
                                        }, 5000);
                                    }
                                },
                                error: function (result) {
                                    $("#errorMessageDiv").html(result.Message);
                                    $("#errorMessageDiv").removeAttr('hidden');
                                    setTimeout(function () {
                                        $("#errorMessageDiv").prop('hidden', 'hidden');
                                    }, 5000);
                                }
                            })
                    }
                    else {
                        $.ajax(
    {
        url: '@Url.Action("AddCategory","Home")',
        type: 'post',
        datatype: 'json',
        data: { IsNewCategory: true, Name: $("#txtCategoryName").val(), CategoryDescription: $("#txtDescription").val(), categoryKeywords: $("#txtKeywords").val() },
        success: function (result) {
            if (result.HasValue) {
                UpdateTableContent();
                $("#txtCategoryName").val("");
                $("#txtDescription").val("");
                $("#txtKeywords").val("");
                NidCurrentCategory = 0;
                IsCategoryAdded = false;
                $("#BrandWrap").html("");
                $("#TypeWrap").html("");
                $("#successfullMessageDiv").html('category added successfully!');
                $("#successfullMessageDiv").removeAttr('hidden');
                setTimeout(function () {
                    $("#successfullMessageDiv").prop('hidden', 'hidden');
                }, 5000);
            } else {
                $("#errorMessageDiv").html(result.Message);
                $("#errorMessageDiv").removeAttr('hidden');
                setTimeout(function () {
                    $("#errorMessageDiv").prop('hidden', 'hidden');
                }, 5000);
            }
        },
        error: function (result) {
            $("#errorMessageDiv").html(result.Message);
            $("#errorMessageDiv").removeAttr('hidden');
            setTimeout(function () {
                $("#errorMessageDiv").prop('hidden', 'hidden');
            }, 5000);
        }
    })
                    }
                }
            });
            $("#btnAddBrand").click(function (e) {
                e.preventDefault();
                if ($("#txtBrandName").val() == '' || $("#txtCategoryName").val() == '') {
                    $("#warningMessageDiv").html('fill the fields');
                    $("#warningMessageDiv").removeAttr('hidden');
                    setTimeout(function () {
                        $("#warningMessageDiv").prop('hidden', 'hidden');
                    }, 3000);
                } else {
                    if (IsCategoryAdded) {
                        $.ajax(
                         {
                             url: '@Url.Action("AddBrandOrType", "Home")',
                             type: 'post',
                             datatype: 'json',
                             data: { IsBrand: true, Name: $("#txtBrandName").val(), NidCategory: NidCurrentCategory, IsNewCategory: !IsCategoryAdded },
                             success: function (result) {
                                 if (result.HasValue) {
                                     $("#BrandWrap").html(result.Html);
                                     $("#txtBrandName").val("");
                                 } else {
                                     $("#errorMessageDiv").html(result.Message);
                                     $("#errorMessageDiv").removeAttr('hidden');
                                     setTimeout(function () {
                                         $("#errorMessageDiv").prop('hidden', 'hidden');
                                     }, 5000);
                                 }
                             },
                             error: function (result) {
                                 $("#errorMessageDiv").html(result.Message);
                                 $("#errorMessageDiv").removeAttr('hidden');
                                 setTimeout(function () {
                                     $("#errorMessageDiv").prop('hidden', 'hidden');
                                 }, 5000);
                             }
                         }
                                )
                    } else {
                        $.ajax(
                         {
                             url: '@Url.Action("AddBrandOrType", "Home")',
                             type: 'post',
                             datatype: 'json',
                             data: { IsBrand: true, Name: $("#txtBrandName").val(), CategoryName: $("#txtCategoryName").val(), IsNewCategory: !IsCategoryAdded, CategoryDescription: $("#txtDescription").val(), categoryKeywords: $("#txtKeywords").val() },
                             success: function (result) {
                                 IsCategoryAdded = true;
                                 NidCurrentCategory = result.tmpNidCategory;
                                 if (result.HasValue) {
                                     $("#BrandWrap").html(result.Html);
                                     $("#txtBrandName").val("");
                                 } else {
                                     $("#errorMessageDiv").html(result.Message);
                                     $("#errorMessageDiv").removeAttr('hidden');
                                     setTimeout(function () {
                                         $("#errorMessageDiv").prop('hidden', 'hidden');
                                     }, 5000);
                                 }
                             },
                             error: function (result) {
                                 $("#errorMessageDiv").html(result.Message);
                                 $("#errorMessageDiv").removeAttr('hidden');
                                 setTimeout(function () {
                                     $("#errorMessageDiv").prop('hidden', 'hidden');
                                 }, 5000);
                             }
                         }
                                )
                    }
                }
            });
            $("#btnAddType").click(function (e) {
                e.preventDefault();
                if ($("#txtTypeName").val() == '' || $("#txtCategoryName").val() == '') {
                    $("#warningMessageDiv").html('fill the fields');
                    $("#warningMessageDiv").removeAttr('hidden');
                    setTimeout(function () {
                        $("#warningMessageDiv").prop('hidden', 'hidden');
                    }, 3000);
                } else {
                    if (IsCategoryAdded) {
                        $.ajax(
                         {
                             url: '@Url.Action("AddBrandOrType", "Home")',
                             type: 'post',
                             datatype: 'json',
                             data: { IsBrand: false, Name: $("#txtTypeName").val(), NidCategory: NidCurrentCategory, IsNewCategory: !IsCategoryAdded },
                             success: function (result) {
                                 if (result.HasValue) {
                                     $("#TypeWrap").html(result.Html);
                                     $("#txtTypeName").val("");
                                 } else {
                                     $("#errorMessageDiv").html(result.Message);
                                     $("#errorMessageDiv").removeAttr('hidden');
                                     setTimeout(function () {
                                         $("#errorMessageDiv").prop('hidden', 'hidden');
                                     }, 5000);
                                 }
                             },
                             error: function (result) {
                                 $("#errorMessageDiv").html(result.Message);
                                 $("#errorMessageDiv").removeAttr('hidden');
                                 setTimeout(function () {
                                     $("#errorMessageDiv").prop('hidden', 'hidden');
                                 }, 5000);
                             }
                         }
                                )
                    } else {
                        $.ajax(
                         {
                             url: '@Url.Action("AddBrandOrType", "Home")',
                             type: 'post',
                             datatype: 'json',
                             data: { IsBrand: false, Name: $("#txtTypeName").val(), CategoryName: $("#txtCategoryName").val(), IsNewCategory: !IsCategoryAdded, CategoryDescription: $("#txtDescription").val(), categoryKeywords: $("#txtKeywords").val() },
                             success: function (result) {
                                 IsCategoryAdded = true;
                                 NidCurrentCategory = result.tmpNidCategory;
                                 if (result.HasValue) {
                                     $("#TypeWrap").html(result.Html);
                                     $("#txtTypeName").val("");
                                 } else {
                                     $("#errorMessageDiv").html(result.Message);
                                     $("#errorMessageDiv").removeAttr('hidden');
                                     setTimeout(function () {
                                         $("#errorMessageDiv").prop('hidden', 'hidden');
                                     }, 5000);
                                 }
                             },
                             error: function (result) {
                                 $("#errorMessageDiv").html(result.Message);
                                 $("#errorMessageDiv").removeAttr('hidden');
                                 setTimeout(function () {
                                     $("#errorMessageDiv").prop('hidden', 'hidden');
                                 }, 5000);
                             }
                         }
                                )
                    }
                }
            });
            $("#btnClearForm").click(function (e)
            {
                e.preventDefault();
                $("#txtCategoryName").val("");
                $("#txtDescription").val("");
                $("#txtKeywords").val("");
                NidCurrentCategory = 0;
                IsCategoryAdded = false;
                $("#BrandWrap").html("");
                $("#TypeWrap").html("");
            });
        });
        function EditThis(nidcat)
        {
            $.ajax(
                {
                    url:'@Url.Action("GetEditCategory","Home")',
                    type:'post',
                    datatype:'json',
                    data:{NidCategory:nidcat},
                    success: function (result)
                    {
                        $("#txtCategoryName").val(result.CategoryName);
                        $("#txtDescription").val(result.Description);
                        $("#txtKeywords").val(result.Keywords);
                        $("#TypeWrap").html(result.TypeWrap);
                        $("#BrandWrap").html(result.BrandWrap);
                        IsCategoryAdded = true;
                        NidCurrentCategory = result.NidCategory;
                    },
                    error: function ()
                    {
                        alert('error');
                    }
                })
        }
        function DeleteThis(nidcat)
        {
            swal({   
                title: "Are you sure?",   
                text: "You will not be able to recover this imaginary file!",   
                type: "warning",   
                showCancelButton: true,   
                confirmButtonText: "Yes, delete it!",
            }).then(function () {
                $.ajax(
                    {
                        url: '@Url.Action("DeleteCategory","Home")',
                        type: 'post',
                        datatype: 'json',
                        data: {NidCategory:nidcat},
                        success: function (result)
                        {
                            if (result.HasValue)
                            {
                                swal("deleted!", result.Message, "success");
                                UpdateTableContent();
                            } else {
                                swal(result.Message);
                            }
                        },
                        error: function ()
                        {
                            swal("error");
                        }
                    })
            });
        }
        function UpdateTableContent()
        {
            $.ajax(
         {
    url: '@Url.Action("SyncCategoryTable","Home")',
    type: 'post',
    datatype: 'json',
    data: {},
    success: function (result) {
        if (result.HasValue) {
            $("#tblCategory").html(result.Html);
        }
    },
    error: function () {
        alert('error');
    }
})
        }
        function DetailThis(nidcat)
        {
            $.ajax(
                {
                    url: '@Url.Action("CategoryDetail","Home")',
                    type: 'post',
                    datatype: 'json',
                    data: {NidCategory:nidcat},
                    success: function (result)
                    {
                        if (result.HasValue)
                            $("#DetailModal").html(result.Html);
                        else
                            alert('error');
                    },
                    error: function ()
                    {
                        alert('error')
                    }
                })
            $("#DetailModal").modal('toggle')
            $("#DetailModal").modal('show')
        }
    </script>
    }