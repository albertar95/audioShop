@model AudioShopFrontend.ViewModels.ProfileViewModel

@{
    ViewBag.Title = "MyProfile";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="page-breadcrumb">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <ul class="page-breadcrumb__menu">
                    <li class="page-breadcrumb__nav"><a href="@Url.Action("Index")">خانه</a></li>
                    <li class="page-breadcrumb__nav active">پروفایل</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-12">
            <!-- :::::::::: Start My Account Section :::::::::: -->
            <div class="my-account-area" style="direction:rtl;">
                <div class="row">
                    <div class="col-xl-3 col-md-4">
                        <div class="my-account-menu">
                            <ul class="nav account-menu-list flex-column nav-pills" id="pills-tab" role="tablist">
                                <li>
                                    <a class="active link--icon-left" id="pills-dashboard-tab" data-toggle="pill" href="#pills-dashboard"
                                       role="tab" aria-controls="pills-dashboard" aria-selected="true">
                                        <i class="fas fa-tachometer-alt"></i> داشبورد
                                    </a>
                                </li>
                                <li>
                                    <a id="pills-order-tab" class="link--icon-left" data-toggle="pill" href="#pills-order" role="tab"
                                       aria-controls="pills-order" aria-selected="false">
                                        <i class="fas fa-shopping-cart"></i> سفارشات من
                                    </a>
                                </li>
                                <li>
                                    <a id="pills-download-tab" class="link--icon-left" data-toggle="pill" href="#pills-download" role="tab"
                                       aria-controls="pills-download" aria-selected="false">
                                        <i class="fas fa-star-half-alt"></i> علاقه مندی ها
                                    </a>
                                </li>
                                <li>
                                    <a id="pills-address-tab" class="link--icon-left" data-toggle="pill" href="#pills-address" role="tab"
                                       aria-controls="pills-address" aria-selected="false">
                                        <i class="fas fa-map-marker-alt"></i> آدرس
                                    </a>
                                </li>
                                <li>
                                    <a id="pills-account-tab" class="link--icon-left" data-toggle="pill" href="#pills-account" role="tab"
                                       aria-controls="pills-account" aria-selected="false">
                                        <i class="fas fa-user"></i>
                                        جزییات کاربری
                                    </a>
                                </li>
                                <li>
                                    <a class="link--icon-left" href="login.html"><i class="fas fa-sign-out-alt"></i> خروج</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-xl-8 col-md-8">
                        <div class="tab-content my-account-tab" id="pills-tabContent">
                            <div class="tab-pane fade show active" id="pills-dashboard" role="tabpanel"
                                 aria-labelledby="pills-dashboard-tab">
                                <div class="my-account-dashboard account-wrapper">
                                    <h4 class="account-title">Dashboard</h4>
                                    <div class="welcome-dashboard m-t-30">
                                        <p>
                                            Hello, <strong>Alex Tuntuni</strong> (If Not <strong>Tuntuni !</strong> <a href="#">Logout</a> )
                                        </p>
                                    </div>
                                    <p class="m-t-25">
                                        From your account dashboard. you can easily check &amp; view your
                                        recent orders, manage your shipping and billing addresses and edit your password and
                                        account details.
                                    </p>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="pills-order" role="tabpanel" aria-labelledby="pills-order-tab">
                                <div class="my-account-order account-wrapper">
                                    <h4 class="account-title">سفارشات</h4>
                                    <div class="account-table text-center m-t-30 table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th class="no">ردیف</th>
                                                    <th class="name">نام محصول</th>
                                                    <th class="date">تاریخ سفارش</th>
                                                    <th class="status">وضعیت</th>
                                                    <th class="total">تعداد</th>
                                                    <th class="action">عملیات</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var ord in Model.Orders)
                                                {
                                                <tr>
                                                    <td>1</td>
                                                    <td>@ord.Product.ProductName</td>
                                                    <td>@ord.CreateDate.ToShortDateString()</td>
                                                    <td>@ord.state</td>
                                                    <td>@ord.Quantity</td>
                                                    <td><a href="#">جزییات</a></td>
                                                </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="pills-download" role="tabpanel"
                                 aria-labelledby="pills-download-tab">
                                <div class="my-account-download account-wrapper">
                                    <h4 class="account-title">علاقه مندی ها</h4>
                                    <div class="account-table text-center m-t-30 table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th class="name">نمایه</th>
                                                    <th class="date">نام محصول</th>
                                                    <th class="status">دسته یندی</th>
                                                    <th class="status">قیمت</th>
                                                    <th class="action">وضعیت</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @{
                                                    List<AudioShopFrontend.DTO.ProductDTO> prods = new List<AudioShopFrontend.DTO.ProductDTO>();
                                                    if (Request.Cookies.AllKeys.Contains("AudioShopLogin"))
                                                    {
                                                        if (Request.Cookies.AllKeys.Contains("AudioShopFavorites"))
                                                        {
                                                            string[] fav = Request.Cookies["AudioShopFavorites"].Value.Split(',');
                                                            AudioShopFrontend.Services.DataTransfer dataTransfer = new AudioShopFrontend.Services.DataTransfer();
                                                            foreach (var f in fav)
                                                            {
                                                                prods.Add(dataTransfer.GetProductDtoByID(Guid.Parse(f)));
                                                            }
                                                        }
                                                    }
                                                }
                                                @if (prods.Any())
                                                {
                                                    <tr>
                                                        @foreach (var p in prods)
                                                        {
                                                            if (p.Pictures != null)
                                                            {
                                                                <td><img height="50" width="50" src="@p.Pictures.Split(',').FirstOrDefault()" /></td>
                                                            }
                                                            else
                                                            {
                                                                <td></td>
                                                            }
                                                            <td>@p.ProductName</td>
                                                            <td>@p.NidType</td>
                                                            <td>@p.Price</td>
                                                            <td>@p.State</td>
                                                        }
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="pills-address" role="tabpanel"
                                 aria-labelledby="pills-address-tab">
                                <div class="my-account-address account-wrapper">
                                    <h4 class="account-title">آدرس</h4>
                                    <div class="account-address m-t-30">
                                        <h6 class="name">@Model.UserInfo.FirstName @Model.UserInfo.LastName</h6>
                                        <p>@Model.UserInfo.Address</p>
                                        <p>شماره تماس : </p>
                                        <a class="box-btn m-t-25 " href="#modalEditAddress" data-toggle="modal"><i class="far fa-edit"></i> ویرایش آدرس</a>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="pills-account" role="tabpanel"
                                 aria-labelledby="pills-account-tab">
                                <div class="my-account-details account-wrapper">
                                    <h4 class="account-title">جزییات</h4>

                                    <div class="account-details">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-box__single-group">
                                                    <input type="text" placeholder="نام" value="@Model.UserInfo.FirstName">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-box__single-group">
                                                    <input type="text" placeholder="نام خانوادگی" value="@Model.UserInfo.LastName">
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-box__single-group">
                                                    <input type="text" placeholder="ایمیل" value="@Model.UserInfo.Username">
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-box__single-group">
                                                    <h5 class="title">تغییر کلمه عبور</h5>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-box__single-group">
                                                    <input id="CurrentPassword" type="password" placeholder="کلمه عبور فعلی">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-box__single-group">
                                                    <input id="NewPassword" type="password" placeholder="کلمه عبور جدید">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-box__single-group">
                                                    <input id="RepeatPassword" type="password" placeholder="تکرار کلمه عبور">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-box__single-group">
                                                    <button id="SavePasswordChange" class="btn btn--box btn--small btn--uppercase btn--blue">ذخیره تغییرات</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- :::::::::: End My Account Section :::::::::: -->
        </div>
    </div>
</div>

<div class="modal fade" id="modalEditAddress" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-center">ویرایش آدرس</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-2">
                        </div>
                        <div class="col-md-10">
                            <span class="modal__product-cart-item">لطفا آدرس خود را وارد نمایید</span>
                            <textarea rows="5" style="margin-top:15px;" id="txtAddress" class="form-control">@Model.UserInfo.Address</textarea>
                        </div>
                    </div>
                    <div class="row" style="margin-top:15px;">
                        <div class="modal__product-cart-buttons">
                            <a href="" id="SaveAddress" class="btn btn--box btn--large btn--blue btn--uppercase btn--weight" data-dismiss="modal">ذخیره تغییرات</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@section styles
    {

    <link href="@Url.Content("~/Content/assets/css/notification/notification.css")" rel="stylesheet" />
}
@section scripts
    {
    <script src="@Url.Content("~/Content/assets/js/notification/bootstrap-growl.min.js")"></script>
    <script src="@Url.Content("~/Content/assets/js/notification/notification-active.js")"></script>
    <script type="text/javascript">
        $(function ()
        {
            $("#SavePasswordChange").click(function (e)
            {
                e.preventDefault();
                if($("#CurrentPassword").val().trim() != "" || $("#NewPassword").val().trim() != "" || $("#RepeatPassword").val().trim() != "")
                {
                    if($("#NewPassword").val().trim() == $("#RepeatPassword").val().trim())
                    {
                        $.ajax(
                            {
                                url: '@Url.Action("ChangePassword","Home")',
                                type: 'post',
                                datatype: 'json',
                                data: { CurrentPassword: $("#CurrentPassword").val().trim(), NewPassword: $("#NewPassword").val().trim() },
                                success: function (result)
                                {
                                    if(result.HasValue)
                                    {
                                        myNotify('bottom', 'center', '', 'success', 'animated fadeInLeft', 'animated fadeOutLeft', result.Message);
                                        $("#CurrentPassword").val("");
                                        $("#NewPassword").val("");
                                        $("#RepeatPassword").val("");
                                    } else
                                    {
                                        myNotify('bottom', 'center', '', 'warning', 'animated fadeInLeft', 'animated fadeOutLeft', result.Message);
                                    }
                                },
                                error: function ()
                                {
                                    myNotify('bottom', 'center', '', 'warning', 'animated fadeInLeft', 'animated fadeOutLeft', 'error');
                                }
                            });
                    } else {
                        myNotify('bottom', 'center', '', 'warning', 'animated fadeInLeft', 'animated fadeOutLeft', 'passwords doesnt meet!');
                    }
                } else {
                    myNotify('bottom', 'center', '', 'warning', 'animated fadeInLeft', 'animated fadeOutLeft', 'enter all fields');
                }
            });
            $("#SaveAddress").click(function (e)
            {
                e.preventDefault();
                $.ajax(
                    {
                        url: '@Url.Action("ChangeAddress","Home")',
                        type: 'post',
                        datatype: 'json',
                        data: { NewAddress: $("#txtAddress").val() },
                        success: function (result)
                        {
                            if(result.HasValue)
                            {
                                myNotify('bottom', 'center', '', 'success', 'animated fadeInLeft', 'animated fadeOutLeft', 'done');
                            } else {
                                myNotify('bottom', 'center', '', 'warning', 'animated fadeInLeft', 'animated fadeOutLeft', result.Message);
                            }
                        },
                        error: function () { }
                    });
            });
        });
        function myNotify(from, align, icon, type, animIn, animOut, myMessage) {
            $.growl({
                icon: icon,
                title: '',
                message: myMessage,
                url: ''
            }, {
                element: 'body',
                type: type,
                allow_dismiss: true,
                placement: {
                    from: from,
                    align: align
                },
                offset: {
                    x: 20,
                    y: 85
                },
                spacing: 10,
                z_index: 1031,
                delay: 2500,
                timer: 1000,
                url_target: '_blank',
                mouse_over: false,
                animate: {
                    enter: animIn,
                    exit: animOut
                },
                icon_type: 'class',
                template: '<div data-growl="container" class="alert" role="alert">' +
								'<button type="button" class="close" data-growl="dismiss">' +
									'<span aria-hidden="true">&times;</span>' +
									'<span class="sr-only">Close</span>' +
								'</button>' +
								'<span data-growl="icon"></span>' +
								'<span data-growl="title"></span>' +
								'<span data-growl="message"></span>' +
								'<a href="#" data-growl="url"></a>' +
							'</div>'
            });
        };
    </script>
    }